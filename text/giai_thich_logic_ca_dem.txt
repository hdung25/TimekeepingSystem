# GIẢI THÍCH LOGIC: NHẬN LỚP & CA XUYÊN ĐÊM

## 1. Vấn đề (Ví dụ)
Giáo viên A nhận lớp có lịch: 22:00 (Ngày 20) đến 01:00 (Ngày 21).
Khi họ Check-in lúc 22:00, hệ thống ghi nhận vào ngày 20.
Khi họ Check-out lúc 01:00, thực tế đã là ngày 21.

## 2. Giải pháp hiện tại (ĐÃ ÁP DỤNG TRONG CODE)

Hệ thống sử dụng **Logic Nhận Lớp (Schedule-Based Fallback)** để xử lý trường hợp này mà không cần phức tạp hóa Database:

1. **Bước 1: Nhận Lớp (Bắt buộc)**
   - Nhân viên phải bấm nút "Nhận Lớp" cho ca làm việc này trên lịch (Ngày 20).
   - Hệ thống lưu lại: Ca này bắt đầu 22:00, kết thúc 01:00.

2. **Bước 2: Check-in**
   - Nhân viên Check-in lúc 22:00 ngày 20. Hệ thống mở một phiên làm việc (Session) cho ngày 20.

3. **Bước 3: Check-out (Hoặc Quên)**
   - **Trường hợp A (Lý tưởng):** Nhân viên Check-out trước khi qua ngày (ví dụ ca 23:59).
   - **Trường hợp B (Qua đêm/Quên):** Nếu qua ngày 21, nhân viên mở app sẽ thấy giao diện của ngày 21 (trống trơn, nút "Vào Ca" mới). Họ không thể bấm "Ra Ca" cho ngày 20 được nữa.
     -> **XỬ LÝ TỰ ĐỘNG:** 
     - Khi tính lương (Trang Admin/Báo Cáo), hệ thống quét thấy ngày 20 có Check-in lúc 22:00 nhưng KHÔNG có Check-out.
     - Thay vì báo lỗi, hệ thống **tự động lấy Giờ Kết Thúc của Lớp Đã Nhận (01:00)** làm giờ ra.
     - Kết quả: Nhân viên vẫn được tính đủ 3 tiếng. Thẻ báo cáo hiện màu Cam (Quên ra) nhưng lương vẫn đủ.

## 3. Các quy tắc khác - Đã cập nhật vào Code

- **Quy tắc "Quên Ra Ca"**: Nếu nhân viên có Nhận Lớp và có Check-in, hệ thống mặc định nhân viên làm đủ giờ (trừ khi Admin sửa lại). Điều này bảo vệ quyền lợi nhân viên ca đêm.
- **Quy tắc "Quên Vào Ca"**: Nếu KHÔNG Check-in, hệ thống coi như Vắng (0 giờ lương), dù có Nhận Lớp hay không. Bắt buộc phải có Check-in để chứng minh có mặt.
- **Quy tắc "Chỉnh sửa thủ công"**: Admin có quyền sửa giờ trực tiếp trên Báo Cáo nếu nhân viên khiếu nại (có nút ✏️ trên từng thẻ công).

TÓM LẠI: Việc "Nhận Lớp" là chìa khóa để xử lý ca xuyên đêm. Chỉ cần nhân viên Nhận Lớp và Check-in, hệ thống sẽ tự lo phần còn lại.